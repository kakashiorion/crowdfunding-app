datasource db {
  provider = "postgresql"
  url      = env("TEST_DATABASE_URL")
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = "native"
}

// Define your own datamodels here and run `yarn redwood prisma migrate dev`
// to create migrations for them and apply to your dev DB.

//TODO: Implement SupaBase Storage for profile pic
model User {
  id                     Int               @id @default(autoincrement())
  email                  String            @unique
  hashedPassword         String            @default("")
  salt                   String            @default("")
  resetToken             String?
  resetTokenExpiresAt    DateTime?
  lastLogin              DateTime          @default(now())
  profilePicURL          String?
  mobile                 String            @unique
  otp                    String?
  otpExpiresAt           DateTime?
  webAuthnChallenge      String?           @unique
  credentials            UserCredential[]
  type                   UserType          @default(GUEST)
  investor               Investor?
  startup                Startup?
  isLoggedIn             Boolean           @default(false)
  isOnboarded            Boolean           @default(false)
  likedOnboarding        Boolean?
  sentMessages           Message[]         @relation("Sender")
  receivedMessages       Message[]         @relation("Receiver")
  startedConversations   Conversation[]    @relation("ConvStarter")
  respondedConversations Conversation[]    @relation("ConvResponder")
  posts                  Post[]            @relation("Poster")
  comments               Comment[]         @relation("Commenter")
  likedPosts             Post[]            @relation("UserLikesPost")
  likedComments          Comment[]         @relation("UserLikesComment")
  connectionsRequested   Connection[]      @relation("Requester")
  connectionsAccepted    Connection[]      @relation("Accepter")
  followedBy             User[]            @relation("UserFollows")
  following              User[]            @relation("UserFollows")
  messageVisibility      VisibilityLevel   @default(PUBLIC)
  activityVisbility      VisibilityLevel   @default(PUBLIC)
  profileVisbility       VisibilityLevel   @default(FOLLOWERS)
  notificationLevel      NotificationLevel @default(HIGH)
  prefersTheme           UITheme           @default(SYSTEM)
  createdAt              DateTime          @default(now())
  updatedAt              DateTime          @updatedAt
}

enum UITheme {
  SYSTEM
  LIGHT
  DARK
}

model UserCredential {
  id         String  @id
  userId     Int
  user       User    @relation(fields: [userId], references: [id])
  publicKey  Bytes
  transports String?
  counter    BigInt
}

enum UserType {
  INVESTOR
  STARTUP
  ADMIN
  GUEST
}

model Connection {
  id             Int              @id @default(autoincrement())
  requestingUser User             @relation("Requester", fields: [requesterID], references: [id])
  requesterID    Int
  acceptingUser  User             @relation("Accepter", fields: [accepterID], references: [id])
  accepterID     Int
  status         ConnectionStatus @default(PENDING)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt

  @@unique([requesterID, accepterID])
}

enum ConnectionStatus {
  PENDING
  ACCEPTED
  REJECTED
}

model Investor {
  id                Int                 @id @unique
  user              User                @relation(fields: [id], references: [id])
  name              String
  dateOfBirth       DateTime?
  locationID        Int //from Location table
  linkedInURL       String?
  websiteURL        String?
  eduBG             EducationBG?
  yearsOfWorkEx     SizeRange?
  numberOfCompanies SizeRange?
  workedInSectors   Sector[] // from Sector table
  investorExp       InvestorExperience?
  investorObjective InvestorObjective?
  bids              Bid[]
  successfulOffers  Offer[]             @relation("SuccessfulDeal")
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
}

//TODO: Need to upload city data in Location table
model Location {
  id        Int      @id @default(autoincrement())
  state     String
  city      String?
  lat       Float?
  long      Float?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([state, city])
}

enum EducationBG {
  HIGH_SCHOOL
  BACHELORS
  MASTERS
  PHD
}

model InvestorExperience {
  id                 Int            @id @unique
  investor           Investor       @relation(fields: [id], references: [id])
  workedInStartups   SizeRange
  foundedStartups    SizeRange
  investedStartups   SizeRange
  investedStages     FundingStage[]
  investedAmountLacs AmountRange?
  successfulExits    SizeRange?
  returnsReceived    ReturnsRange[]
  investedSectors    Sector[]
  investorLevel      InvestorLevel
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
}

enum SizeRange {
  NONE
  ONE_TO_THREE
  THREE_TO_TEN
  TEN_TO_TWENTY
  MORE_THAN_TWENTY
}

enum ReturnsRange {
  BREAKEVEN
  TWO
  THREE
  FIVE
  TEN
  TWENTY
  FIFTY
  HUNDRED
}

enum InvestorLevel {
  NOVICE
  INTERMEDIATE
  EXPERIENCED
  PROFESSIONAL
  SEASONED
}

enum FundingStage {
  SEED
  SERIES_A
  SERIES_B
  SERIES_C
  SERIES_D
  SERIES_E
  SERIES_F
  LATER
}

enum AmountRange {
  LESS_THAN_ONE_LAC
  ONE_TO_FIVE_LACS
  FIVE_TO_TWENTY_LACS
  TWENTY_LACS_TO_ONE_CRORE
  MORE_THAN_1_CRORE
}

model InvestorObjective {
  id                        Int                    @id @unique
  investor                  Investor               @relation(fields: [id], references: [id])
  preferredAmountToInvest   AmountRange?
  preferredFundingStages    FundingStage[]
  preferredStartupTeamSizes StartupTeamSize[]
  preferredTimelines        TimelineRange[]
  riskApetite               RiskApetite?
  preferredSectors          Sector[]
  preferredLocations        Int[] //from Location table
  platformGoal              InvestorPlatformGoal[]
  referSource               ReferSource[]
  createdAt                 DateTime               @default(now())
  updatedAt                 DateTime               @updatedAt
}

enum TimelineRange {
  LESS_THAN_SIX_MONTHS
  SIX_TO_TWELVE_MONTHS
  ONE_TO_TWO_YEARS
  TWO_TO_FIVE_YEARS
  FIVE_TO_TEN_YEARS
  MORE_THAN_TEN_YEARS
}

enum RiskApetite {
  LOW
  MEDIUM
  HIGH
}

enum StartupTeamSize {
  ONE
  BETWEEN_1_AND_10
  BETWEEN_10_AND_50
  BETWEEN_50_AND_200
  BETWEEN_200_AND_1000
  OVER_1000
}

enum InvestorPlatformGoal {
  INVESTING
  CONNECTING
  LEARNING
  EXPLORING
  CONSULTING
  RESEARCHING
}

enum ReferSource {
  WORD_OF_MOUTH
  SOCIAL_MEDIA
  BROWSING
  REFERRAL
  ADVERTISEMENT
  OTHER
}

enum VisibilityLevel {
  PRIVATE
  CONNECTIONS
  FOLLOWERS
  PUBLIC
}

enum NotificationLevel {
  NONE
  LOW
  MEDIUM
  HIGH
}

model Startup {
  id                Int                @id @unique
  user              User               @relation(fields: [id], references: [id])
  name              String
  writeUp           String
  dateIncorporated  DateTime
  linkedInURL       String?
  websiteURL        String?
  locationID        Int //from Location table
  sectorCategoryID  Int //from SectorCategory table
  startupBackground StartupBackground?
  startupBusiness   StartupBusiness?
  startupMarket     StartupMarket?
  startupFinancials StartupFinancials?
  startupObjective  StartupObjective?
  offers            Offer[]            @relation("OffersByStartup")
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
}

model SectorCategory {
  id        Int      @id @default(autoincrement())
  sector    Sector
  category  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([sector, category])
}

//TODO: First level of sectors
enum Sector {
  EDUCATION
  HEALTHCARE
  PHARMACEUTICALS
  BANKING_AND_FINANCE
  ENERGY
  CONSUMER_GOODS
  RETAIL_ECOMMERCE
  REAL_ESTATE
  FOOD_AND_BEVERAGE
  IT
  IOT
  AGRICULTURE
  MANUFACTURING
  FASHION
  MEDIA
  GAMING
  ENTERTAINMENT
  TELECOM
  LOGISTICS
  TRANSPORTATION
  AUTOMOTIVE
  AVIATION
  HEAVY_MACHINERY
  CHEMICAL
  CONSTRUCTION
  DEFENCE
  ELECTRONICS
  FISHERIES
  MINING
  BIOTECHNOLOGY
  LEGAL
  SPORTS_AND_FITNESS
  WASTE_MANAGEMENT
  WATER_MANAGEMENT
  TRAVEL_AND_HOSPITALITY
  SECURITY
  SOCIAL_SERVICE
  MARKETING
  HUMAN_RESOURCES
  BUSINESS_MANAGEMENT
  AUTOMATION
}

model StartupBackground {
  id              Int              @id @unique
  startup         Startup          @relation(fields: [id], references: [id])
  valueProp       String?
  idea            String?
  whyThis         String?
  foundedBefore   SizeRange?
  mission         String?
  vision          String?
  coreValues      String[]
  startupTeamSize StartupTeamSize?
  keyPeople       KeyPeople[]
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
}

model KeyPeople {
  id                  Int               @id @default(autoincrement())
  startupBackground   StartupBackground @relation(fields: [startupBackgroundID], references: [id])
  startupBackgroundID Int
  name                String
  role                String
  writeup             String?
  linkedInURL         String?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
}

model StartupBusiness {
  id                Int               @id @unique
  startup           Startup           @relation(fields: [id], references: [id])
  numberUsers       UserRange?
  numberCities      SizeRange?
  distributionType  DistributionType?
  partners          String[]
  customers         String[]
  workedWell        String[]
  challenges        String[]
  couldImprove      String[]
  currentActivities String[]
  hasOnlineBusiness OnlineBusiness?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
}

enum OnlineBusiness {
  YES
  SETTING_UP
  PLANNED
  NO
}

enum UserRange {
  LESS_THAN_100
  BETWEEN_100_AND_1000
  BETWEEN_1000_AND_10000
  BETWEEN_10000_AND_1_LAC
  BETWEEN_1_LAC_AND_10_LACS
  BETWEEEN_10_LACS_AND_1_CRORE
  MORE_THAN_1_CRORE
}

enum DistributionType {
  B2B
  B2C
  BOTH
  OTHER
}

model StartupMarket {
  id               Int              @id @unique
  startup          Startup          @relation(fields: [id], references: [id])
  revenueStreams   RevenueStreams[]
  costHeads        CostHeads[]
  shortTermPlan    ShortTermPlan?
  marketSizeInCr   MarketSize?
  marketGrowthRate GrowthRate?
  trends           String[]
  opporunities     String[]
  threats          String[]
  competitors      String[]
  xFactor          String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
}

enum MarketSize {
  LESS_THAN_10_CR
  BETWEEN_10_AND_100_CR
  BETWEEN_100_AND_1000_CR
  BETWEEN_1000_AND_10000_CR
  BETWEEN_10000_AND_1_LAC_CR
  MORE_THAN_1_LAC_CR
}

enum GrowthRate {
  LESS_THAN_5
  BETWEEN_5_TO_10
  BETWEEN_10_TO_20
  BETWEEN_20_TO_50
  BETWEEN_50_TO_100
  MORE_THAN_100
}

enum RevenueStreams {
  SELLING_GOODS
  RENTAL_OR_LEASING
  ADS_OR_SPONSORS
  COMMISSION_FEE
  SUBSCRIPTION_OR_LICENSING
  DONATIONS
  FREEMIUM
  OTHER
}

enum CostHeads {
  MATERIAL
  WAGES
  RENT
  INTEREST
  EQUIPMENT
  MARKETING
  ADMIN
  OTHER
}

enum ShortTermPlan {
  EXPAND_GEOGRAPHICALLY
  GO_FOR_IPO
  HIRE_AND_EXPAND_TEAM
  IMPROVE_PRODUCT_OR_SERVICE
  BUILD_CUSTOMER_BASE
  OTHER
}

model StartupFinancials {
  id                  Int                @id @unique
  startup             Startup            @relation(fields: [id], references: [id])
  latestFundingStage  FundingStage?
  latestValuationInCr Float?
  latestCapTable      CapTable[]
  fundraisingRounds   FundraisingRound[]
  currentRatio        DecimalRange?
  debtEquityRatio     DecimalRange?
  revenueLastFY       RevenueRange?
  revenueGrowthRate   GrowthRate?
  margin              Margin?
  cashRunway          TimelineRange?
  plansForUsingCash   String[]
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
}

enum DecimalRange {
  LESS_THAN_HALF
  BETWEEN_HALF_AND_ONE
  BETWEEN_ONE_AND_TWO
  MORE_THAN_TWO
}

enum RevenueRange {
  LESS_THAN_10_LACS
  BETWEEN_10_TO_20_LACS
  BETWEEN_20_TO_50_LACS
  BETWEEN_50_TO_100_LACS
  BETWEEN_1_TO_10_CR
  BETWEEN_10_TO_50_CR
  BETWEEN_50_TO_100_CR
  MORE_THAN_100_CRORE
}

enum Margin {
  LOSS_OVER_50
  LOSS_BETWEEN_20_AND_50
  LOSS_LESS_THAN_20
  PROFIT_LESS_THAN_20
  PROFIT_BETWEEN_20_AND_50
  PROFIT_OVER_50
}

model FundraisingRound {
  id                Int               @id @default(autoincrement())
  startup           StartupFinancials @relation(fields: [startupID], references: [id])
  startupID         Int
  fundingStage      FundingStage
  capitalRaisedInCr Float
  valuationInCr     Float
  keyInvestors      String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
}

model CapTable {
  id                  Int               @id @default(autoincrement())
  startupFinancials   StartupFinancials @relation(fields: [startupFinancialsID], references: [id])
  startupFinancialsID Int
  shareholderName     String
  equityShare         Float
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
}

model StartupObjective {
  id                      Int                   @id @unique
  startup                 Startup               @relation(fields: [id], references: [id])
  preferredInvestorLevels InvestorLevel[]
  preferredLocations      Int[] //from Location table
  expectedTimeline        TimelineRange?
  promisingReturns        ReturnsRange?
  platformGoal            StartupPlatformGoal[]
  referSource             ReferSource[]
  pitchDeckURL            String?
  demoURL                 String[]
  createdAt               DateTime              @default(now())
  updatedAt               DateTime              @updatedAt
}

enum StartupPlatformGoal {
  RAISING_FUNDS
  EXPLORING
  CONNECTING
  GETTING_ADVICE
}

model Offer {
  id                  Int           @id @default(autoincrement())
  startup             Startup       @relation("OffersByStartup", fields: [startupID], references: [id])
  startupID           Int
  bids                Bid[]
  status              OfferStatus   @default(CREATED)
  extended            Boolean       @default(false)
  capitalTargetLacs   Float
  equityBeingIssued   Float
  minTicketSizeLacs   Float         @default(1.0)
  maxTicketSizeLacs   Float
  fundingStage        FundingStage?
  numberOfInvestors   Int?
  willUseFundsFor     String[]
  needHelpWith        String[]
  timelineDays        Int           @default(30)
  successfulInvestors Investor[]    @relation("SuccessfulDeal")
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
}

enum OfferStatus {
  CREATED
  EXCEEDED
  RAISED
  CLOSED
}

model Bid {
  id               Int           @id @default(autoincrement())
  offer            Offer         @relation(fields: [offerID], references: [id])
  offerID          Int
  investor         Investor      @relation(fields: [investorID], references: [id])
  investorID       Int
  status           BidStatus     @default(CREATED)
  rebid            Boolean       @default(false)
  capitalAvailable Float
  equityNeeded     Float
  counterCapital   Float?
  counterEquity    Float?
  canHelpWith      String[]
  questions        BidQuestion[]
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  @@unique([offerID, investorID]) //An investor can only bid once on an offer
}

enum BidStatus {
  CREATED
  COUNTER
  ACCEPTED
  DECLINED
}

model BidQuestion {
  id        Int      @id @default(autoincrement())
  bid       Bid      @relation(fields: [bidID], references: [id])
  bidID     Int
  question  String
  answered  Boolean  @default(false)
  answer    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Post {
  id            Int             @id @default(autoincrement())
  poster        User            @relation("Poster", fields: [posterID], references: [id])
  posterID      Int
  comments      Comment[]
  likedByUsers  User[]          @relation("UserLikesPost")
  title         String
  writeup       String?
  attachmentURL String?
  visibility    VisibilityLevel @default(PUBLIC)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
}

model Comment {
  id            Int      @id @default(autoincrement())
  commenter     User     @relation("Commenter", fields: [commenterID], references: [id])
  commenterID   Int
  post          Post     @relation(fields: [postID], references: [id])
  postID        Int
  content       String
  attachmentURL String?
  likedByUsers  User[]   @relation("UserLikesComment")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Conversation {
  id                      Int       @id @default(autoincrement())
  conversationStarter     User      @relation("ConvStarter", fields: [conversationStarterID], references: [id])
  conversationStarterID   Int
  conversationResponder   User      @relation("ConvResponder", fields: [conversationResponderID], references: [id])
  conversationResponderID Int
  messages                Message[]
  isFavoriteByStarter     Boolean   @default(false)
  isFavoriteByResponder   Boolean   @default(false)
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt

  @@unique([conversationStarterID, conversationResponderID])
}

model Message {
  id             Int          @id @default(autoincrement())
  conversation   Conversation @relation(fields: [conversationID], references: [id])
  conversationID Int
  sender         User         @relation("Sender", fields: [senderID], references: [id])
  senderID       Int
  receiver       User         @relation("Receiver", fields: [receiverID], references: [id])
  receiverID     Int
  content        String
  attachmentURL  String?
  unread         Boolean      @default(true)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
}
